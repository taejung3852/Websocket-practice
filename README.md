# Websocket과 Spirng 그리고 STOMP

## 1. 웹소켓이란?  
웹소켓(WebSocket)은 실시간 양방향 통신을 가능하게 하는 기술로, 한 번 연결되면 종료 전까지 유지된다. 🌐 화면 새로고침 없이 데이터를 주고받을 수 있다.  
사용 예시:  
- 온라인 게임 (체스, FPS 등) 🎮  
- 실시간 채팅 💬  
- 주식 거래 사이트 📈  

## 2. 웹소켓 vs HTTP  
HTTP도 Polling, Long Polling, Streaming으로 실시간성을 흉내 낼 수 있지만, 웹소켓이 더 효율적이다. 차이점은 이렇다:  

### 2.1 연결 방식  
- HTTP: 요청마다 연결을 새로 맺고 끊음  
- 웹소켓: 한 번 연결로 쭉 유지 🔗  
→ 연결 비용 줄어듦

> 먼저 TCP 연결을 한다. 그리고 HTTP 연결을 할 때 헤더에 Connection: Upgrade를 통해 웹소켓 통신을 시작한다.
> 그래서 웹소켓도 3 way handshake 아닌가? 했는데 정확히 말하면 http를 통해 한번만 연결하기 때문에 3 way handshake는 아니라고 한다. 

### 2.2 통신 방식  
- HTTP: 클라이언트 요청 시 서버 응답 (단방향)  
- 웹소켓: 서버와 클라이언트 모두 자유롭게 데이터 전송 (양방향) ↔️  

### 2.3 데이터 전송량  
- HTTP: 매번 헤더 등 추가 데이터 전송  
- 웹소켓: 초기 연결 후 최소한의 데이터만 주고받음 📦  
→ 네트워크 부하 감소  

실시간성이 필요하면 웹소켓이 더 낫다! 👍  

→ 하지만 브라우저중에 웹소켓을 지원하지 않는 브라우저들이 있는데 이 브라우저들은 `sockJS`나 `socket.io`라이브러리를 사용해서 straeming을 사용한다. 여기서 streaming도 지원하지 않는 브러우저는 polling을 사용하도록 해서 웹소켓과 비슷한 기능을 하도록 한다.

## 3. 웹소켓 활용  
- 사용자 간 실시간 데이터 교환 (게임, 채팅, 거래 등)  
- 빈번한 데이터 업데이트가 필요한 서비스 🔄  
- 서버에서 클라이언트로 바로 데이터 전송 시 📢  

## 4. 스프링에서의 웹소켓  
스프링은 웹소켓을 쉽게 쓸 수 있게 지원한다. STOMP 프로토콜과 Spring-Messaging을 활용하면 코드로 실시간 기능을 깔끔하게 구현 가능하다. 🚀  

### 4.1 STOMP란?  
STOMP(Simple Text Oriented Messaging Protocol)는 웹소켓 위에서 동작하는 경량 메시징 프로토콜이다. 💡  
- **특징**: 텍스트 기반으로 간단하고, 메시지 브로커를 통해 구독/발행 모델을 지원한다.

<p align="center">
  <img width="600" alt="image" src="https://github.com/user-attachments/assets/ddca3e25-af6a-4514-9099-8b479e1e42c6" />
</p>
  
- **장점**: 클라이언트가 특정 주제(Topic)를 구독하면 서버가 해당 주제로 메시지를 보낼 수 있다. 예: 채팅방별 메시지 구분. 📩  
- **스프링에서**: `@MessageMapping`으로 엔드포인트를 정의하고, `SimpMessagingTemplate`으로 메시지를 전송한다.

> 일반적인 웹소켓은 `정해진 명세`가 없어서 아무 `문자열`이나 주고 받을 수 있다. 하지만 `STOMP`라는 프로토콜을 사용하면 형식에 맞게 메시지를 주고받을 수 있다.
